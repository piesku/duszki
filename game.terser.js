(()=>{function t(t,i){let e=t.i.t();for(let h of i)h(t,e);return e}function i(t,i,e){let h=t.createShader(i);return t.shaderSource(h,e),t.compileShader(h),h}function e(t,i,e,h,n,o,l){return t[0]=i,t[1]=e,t[2]=h,t[3]=n,t[4]=o,t[5]=l,t}function h(t,i){let e=i[0],h=i[1],n=i[2],o=i[3],l=i[4],s=i[5],r=e*o-h*n;return r?(r=1/r,t[0]=o*r,t[1]=-h*r,t[2]=-n*r,t[3]=e*r,t[4]=(n*s-o*l)*r,t[5]=(h*l-e*s)*r,t):null}function n(t,i,e){let h=i[0],n=i[1],o=i[2],l=i[3],s=i[4],r=i[5],g=e[0],d=e[1],c=e[2],u=e[3],a=e[4],w=e[5];return t[0]=h*g+o*d,t[1]=n*g+l*d,t[2]=h*c+o*u,t[3]=n*c+l*u,t[4]=h*a+o*w+s,t[5]=n*a+l*w+r,t}function o(t,i,e,h){let n=Math.sin(e),o=Math.cos(e);return t[0]=o*h[0],t[1]=n*h[0],t[2]=-n*h[1],t[3]=o*h[1],t[4]=i[0],t[5]=i[1],t}function l(t,i){return t[0]=i[4],t[1]=i[5],t}function s(t,i,h){return e(t,i,0,0,h,0,0),t}function r(t,i){l(i.h,t),i.o[0]=i.h[0]-i.l[0]/2,i.o[1]=i.h[1]-i.l[1]/2,i.g[0]=i.h[0]+i.l[0]/2,i.g[1]=i.h[1]+i.l[1]/2}function g(t,i){let e=t.h[0]-i.h[0],h=t.l[0]/2+i.l[0]/2-Math.abs(e),n=t.h[1]-i.h[1],o=t.l[1]/2+i.l[1]/2-Math.abs(n);return h<o?[h*Math.sign(e),0]:[0,o*Math.sign(n)]}function d(t,i,e){for(let o=0;o<e;o++){let e=i[o],l=t.u&e.p,s=e.u&t.p;if((l||s)&&(h=t).o[0]<(n=e).g[0]&&h.g[0]>n.o[0]&&h.o[1]<n.g[1]&&h.g[1]>n.o[1]){let i=g(t,e);l&&t._.push({v:e.m,M:i}),s&&e._.push({v:t.m,M:[-i[0],-i[1]]})}}var h,n}function c(t,i){let e=t.i.T[i],h=t.i.F[i];e.A&&(h.A[0]=e.A[0],h.A[1]=e.A[1],t.i.k[i]|=64),e.S&&(h.S=e.S,t.i.k[i]|=64)}function u(t,i){let e=t.i.F[i],h=t.i.$[i];t.C.ArrowLeft&&(e.A[0]-=1,t.i.k[i]|=64),t.C.ArrowRight&&(e.A[0]+=1,t.i.k[i]|=64),t.C.ArrowUp&&h.D&&(h.R[1]=500)}function a(t,i){return t[0]=i[0],t[1]=i[1],t}function w(t,i,e){return t[0]=i[0]+e[0],t[1]=i[1]+e[1],t}function p(t,i,e){return t[0]=i[0]*e,t[1]=i[1]*e,t}function _(t,i){let e=i[0],h=i[1],n=e*e+h*h;return n>0&&(n=1/Math.sqrt(n)),t[0]=i[0]*n,t[1]=i[1]*n,t}function f(t,i,e){let h=i[0],n=i[1];return t[0]=e[0]*h+e[2]*n+e[4],t[1]=e[1]*h+e[3]*n+e[5],t}function x(t=[0,0],i=0,e=[1,1]){return(h,n)=>{h.i.k[n]|=576,h.i.P[n]={X:t,S:i,Y:e}}}function y(t){return(i,e)=>{a(i.i.P[e].X,t)}}function v(t,i,e,h=[1,1]){return(n,o)=>{n.i.k[o]|=4,n.i.W[o]={m:o,H:!0,U:t,p:i,u:e,l:h,o:[0,0],g:[0,0],h:[0,0],_:[]}}}function m(t,i=1,e=1){return(h,n)=>{h.i.k[n]|=128,h.i.V[n]={q:1,I:t,j:i,K:e}}}function M(t,i,e=0,h=2*Math.PI){return(n,o)=>{n.i.k[o]|=128,n.i.V[o]={q:2,I:t,L:i,G:e,N:h}}}function T(t,i){return(e,h)=>{e.i.k[h]|=1024,e.i.F[h]={O:t,B:i,A:[0,0],S:0}}}function F(t,i=1,e=.001){return(h,n)=>{h.i.k[n]|=8192,h.i.$[n]={q:t,J:e,Z:i,R:[0,0],tt:[0,0],it:[0,0],et:0,D:!1}}}function A(t=!1){return(i,e)=>{i.i.k[e]|=32832,i.i.ht[e]={i:i.nt.subarray(e*ht,e*ht+6),ot:[1,0,0,1,0,0],lt:t}}}function k(t){return[A(),x(),v(!0,2,3),F(1,.3),(t,i)=>{t.i.k[i]|=16,t.i.st[i]={}},T(7,0),m("red"),(t,i)=>{t.i.k[i]|=256,t.i.rt[i]={gt:10,dt:void 0}}]}function S(...i){return(e,h)=>{32&e.i.k[h]||(e.i.k[h]|=32,e.i.ct[h]={ct:[]});let n=e.i.ct[h].ct;for(let h of i){let i=t(e,h);n.push(i)}}}function $(t,i){if(32&t.k[i])for(let e of t.ct[i].ct)$(t,e);0===t.k[i]||t.ut(i)}function b(t,i,e){let h=t.i.rt[i];h.gt-=e,h.gt<0&&$(t.i,i)}function z(t,i,e){let h=t.i.P[i],n=t.i.F[i];if(n.A[0]||n.A[1]){st[0]=n.A[0],st[1]=n.A[1];let l=Math.min(1,Math.hypot((o=st)[0],o[1]));if(32768&t.i.k[i]){let e=t.i.ht[i];!function(t,i,e){let h=i[0],n=i[1];t[0]=e[0]*h+e[2]*n,t[1]=e[1]*h+e[3]*n}(st,st,void 0!==e.wt?t.i.ht[e.wt].ot:e.i)}else!function(t,i,e){let h=Math.cos(e),n=Math.sin(e);t[0]=h*i[0]-n*i[1],t[1]=n*i[0]+h*i[1]}(st,st,h.S);_(st,st),p(st,st,l*n.O*e),w(h.X,h.X,st),n.A[0]=0,n.A[1]=0}var o;n.S&&(h.S+=n.S*n.B*e,n.S=0)}function C(t,i,e){let h=t.i.P[i],n=t.i.$[i];if(1===n.q){let i=t._t/2,e=t.ft/2;h.X[1]>i&&(h.X[1]=i,n.tt[1]*=-n.Z),h.X[1]<-i&&(h.X[1]=-i,n.tt[1]*=-n.Z),h.X[0]<-e&&(h.X[0]=-e,n.tt[0]*=-n.Z),h.X[0]>e&&(h.X[0]=e,n.tt[0]*=-n.Z)}}function D(t,i,e){let h=t.i.P[i],n=t.i.$[i];var o;1===n.q&&(n.tt[1]+=-9.8*e,p(n.R,n.R,e),w(n.tt,n.tt,n.R),p(n.tt,n.tt,1-n.J),p(rt,n.tt,e),w(h.X,h.X,rt),h.S+=n.et*e,t.i.k[i]|=64,(o=n.R)[0]=0,o[1]=0)}function R(t,i){let e=t.i.P[i],h=t.i.$[i],n=t.i.W[i];if(1===h.q){h.D=!1;let s=!1;for(let r=0;r<n._.length;r++){let g=n._[r];if(8192&t.i.k[g.v]){s=!0,w(e.X,e.X,g.M),t.i.k[i]|=64;let n=t.i.$[g.v];switch(n.q){case 0:_(dt,g.M),p(dt,dt,-2*((o=h.tt)[0]*(l=dt)[0]+o[1]*l[1])),w(h.it,h.tt,dt);break;case 1:a(h.it,n.tt)}p(h.it,h.it,h.Z),g.M[1]>0&&h.it[1]<1&&(h.it[1]=0,h.D=!0)}}s||a(h.it,h.tt)}var o,l}function P(t,i){if(32&t.k[i]){let e=t.ct[i];for(let i of e.ct)if(131072&t.k[i])return!0}return!1}function E(t,i){let e=t.xt,h=t.yt;t.vt.useProgram(e.Mt),t.vt.uniformMatrix3x2fv(e.Ft.Tt,!1,i.Tt),t.vt.activeTexture(33984),t.vt.bindTexture(J,h.At),t.vt.uniform1i(e.Ft.kt,0),t.vt.uniform2f(e.Ft.St,h.j,h.K),t.vt.bindBuffer(B,t.$t),t.vt.bufferData(B,t.nt,35040),t.vt.drawArraysInstanced(e.bt,0,4,t.i.k.length)}function X(t,i,e){let h=i*ht;t.nt[h+12]=ut[e].x,t.nt[h+13]=ut[e].y,t.nt[h+14]=ut[e].width,t.nt[h+15]=ut[e].height}function Y(t,i,e){let h=t.i.zt[i];for(let e in h.Ct)if(h.Dt<h.Ct[e]){X(t,i,e);break}h.Dt+=e,h.Dt>=h.Rt&&(h.Dt-=h.Rt)}function W(t,i){let e=t.i.Pt[i];e.Et=t.Et,e.Xt=t.Xt;let n=e.Yt,o=t.Et/t.Xt;if(0===n.L[0]&&0===n.L[1]){let i=t.Xt/32/2;s(n.Wt,i*o,i)}else o<n.L[0]/n.L[1]?s(n.Wt,n.L[0],n.L[0]/o):s(n.Wt,n.L[1]*o,n.L[1]);h(n.Yt,n.Wt)}function H(t,i){let e=t.i.Ht[i],h=t.i.P[i];h.X[0]=(Math.random()-.5)*e.L*2,h.X[1]=(Math.random()-.5)*e.L*2,t.i.k[i]|=64}function U(i,e,h){let n=i.i.Ut[e];n.Vt+=h,n.Vt>n.qt&&(n.Vt=0,l(at,i.i.ht[e].i),i.i.k.length-i.i.It.length<i.i.jt&&t(i,[...n.Kt(i),y(at)]))}function V(t,i,e){let h=t.i.Lt[i];h.Vt+=e,h.Vt>h.Gt&&(h.Vt=0,(t.i.k[i]&h.u)===h.u?t.i.k[i]&=~h.u:t.i.k[i]|=h.u)}function q(t,i){for(let i=0;i<t.i.k.length;i++)576==(576&t.i.k[i])&&(32768&t.i.k[i]?j(t,i):I(t,i))}function I(t,i){t.i.k[i]&=-65;let e=t.i.P[i],h=i*ht;t.nt[h+0]=e.Y[0],t.nt[h+1]=e.Y[1],t.nt[h+2]=e.S*pt,t.nt[h+4]=e.X[0],t.nt[h+5]=e.X[1]}function j(t,i,e){t.i.k[i]&=-65;let s=t.i.P[i],r=t.i.ht[i];if(o(r.i,s.X,s.S*pt,s.Y),void 0!==e&&(r.wt=e),void 0!==r.wt&&(n(r.i,t.i.ht[r.wt].i,r.i),r.lt&&(l(_t,r.i),o(r.i,_t,s.S*pt,s.Y))),h(r.ot,r.i),32&t.i.k[i]){let e=t.i.ct[i];for(let h=0;h<e.ct.length;h++){let n=e.ct[h];33280==(33280&t.i.k[n])&&j(t,n,i)}}}function K(t,i){let e=t.i.W[i];for(let t of e._);}function L(t,...i){return t.reduce(((t,e)=>t+function(t){let i=t.shift();return"boolean"==typeof i||null==i?"":Array.isArray(i)?i.join(""):i}(i)+e))}function G(t,i){let e=L`
<div style="margin: 10px;">
<h1 style="float: left; margin-right: 10px;">NewProject2D</h1>
<div>Click to spawn new squares.</div>
<div>Use the arrow keys to move all squares at once.</div>
<div>A square lives for ${10} seconds.</div>
</div>
`;e!==O&&(t.Nt.innerHTML=O=e)}function N(t=0,i=1){return((xt=16807*xt%2147483647)-1)/2147483646*(i-t)+t}var O,B=34962,J=3553,Q=5126,Z=document.getElementById("update"),tt=document.getElementById("delta"),it=document.getElementById("fps"),et=1/60,ht=16,nt=class extends class{constructor(t=1e4){this.k=[],this.It=[],this.jt=t}t(){return this.It.length>0?this.It.pop():this.k.push(0)-1}ut(t){this.k[t]=0,this.It.push(t)}}{constructor(){super(...arguments),this.zt=[],this.Pt=[],this.W=[],this.T=[],this.st=[],this.ct=[],this.V=[],this.rt=[],this.P=[],this.F=[],this.Ot=[],this.Bt=[],this.$=[],this.Ht=[],this.ht=[],this.Ut=[],this.Jt=[],this.Lt=[],this.Qt=[]}},ot=0,lt=[0,0],st=[0,0],rt=[0,0],gt=8708,dt=[0,0],ct=131072,ut={"tile_0000.png":{x:0,y:0,width:16,height:16},"tile_0001.png":{x:16,y:0,width:16,height:16},"tile_0002.png":{x:0,y:16,width:16,height:16},"tile_0003.png":{x:16,y:16,width:16,height:16},"tile_0004.png":{x:32,y:0,width:16,height:16},"tile_0005.png":{x:32,y:16,width:16,height:16},"tile_0006.png":{x:0,y:32,width:16,height:16},"tile_0007.png":{x:16,y:32,width:16,height:16},"tile_0008.png":{x:32,y:32,width:16,height:16},"tile_0009.png":{x:48,y:0,width:16,height:16},"tile_0010.png":{x:48,y:16,width:16,height:16},"tile_0011.png":{x:48,y:32,width:16,height:16},"tile_0012.png":{x:0,y:48,width:16,height:16},"tile_0013.png":{x:16,y:48,width:16,height:16},"tile_0014.png":{x:32,y:48,width:16,height:16},"tile_0015.png":{x:48,y:48,width:16,height:16},"tile_0016.png":{x:64,y:0,width:16,height:16},"tile_0017.png":{x:64,y:16,width:16,height:16},"tile_0018.png":{x:64,y:32,width:16,height:16},"tile_0019.png":{x:64,y:48,width:16,height:16},"tile_0020.png":{x:0,y:64,width:16,height:16},"tile_0021.png":{x:16,y:64,width:16,height:16},"tile_0022.png":{x:32,y:64,width:16,height:16},"tile_0023.png":{x:48,y:64,width:16,height:16},"tile_0024.png":{x:64,y:64,width:16,height:16},"tile_0025.png":{x:80,y:0,width:16,height:16},"tile_0026.png":{x:80,y:16,width:16,height:16},"tile_0027.png":{x:80,y:32,width:16,height:16},"tile_0028.png":{x:80,y:48,width:16,height:16},"tile_0029.png":{x:80,y:64,width:16,height:16},"tile_0030.png":{x:0,y:80,width:16,height:16},"tile_0031.png":{x:16,y:80,width:16,height:16},"tile_0032.png":{x:32,y:80,width:16,height:16},"tile_0033.png":{x:48,y:80,width:16,height:16},"tile_0034.png":{x:64,y:80,width:16,height:16},"tile_0035.png":{x:80,y:80,width:16,height:16},"tile_0036.png":{x:96,y:0,width:16,height:16},"tile_0037.png":{x:96,y:16,width:16,height:16},"tile_0038.png":{x:96,y:32,width:16,height:16},"tile_0039.png":{x:96,y:48,width:16,height:16},"tile_0040.png":{x:96,y:64,width:16,height:16},"tile_0041.png":{x:96,y:80,width:16,height:16},"tile_0042.png":{x:0,y:96,width:16,height:16},"tile_0043.png":{x:16,y:96,width:16,height:16},"tile_0044.png":{x:32,y:96,width:16,height:16},"tile_0045.png":{x:48,y:96,width:16,height:16},"tile_0046.png":{x:64,y:96,width:16,height:16},"tile_0047.png":{x:80,y:96,width:16,height:16},"tile_0048.png":{x:96,y:96,width:16,height:16},"tile_0049.png":{x:112,y:0,width:16,height:16},"tile_0050.png":{x:112,y:16,width:16,height:16},"tile_0051.png":{x:112,y:32,width:16,height:16},"tile_0052.png":{x:112,y:48,width:16,height:16},"tile_0053.png":{x:112,y:64,width:16,height:16},"tile_0054.png":{x:112,y:80,width:16,height:16},"tile_0055.png":{x:112,y:96,width:16,height:16},"tile_0056.png":{x:0,y:112,width:16,height:16},"tile_0057.png":{x:16,y:112,width:16,height:16},"tile_0058.png":{x:32,y:112,width:16,height:16},"tile_0059.png":{x:48,y:112,width:16,height:16},"tile_0060.png":{x:64,y:112,width:16,height:16},"tile_0061.png":{x:80,y:112,width:16,height:16},"tile_0062.png":{x:96,y:112,width:16,height:16},"tile_0063.png":{x:112,y:112,width:16,height:16},"tile_0064.png":{x:128,y:0,width:16,height:16},"tile_0065.png":{x:128,y:16,width:16,height:16},"tile_0066.png":{x:128,y:32,width:16,height:16},"tile_0067.png":{x:128,y:48,width:16,height:16},"tile_0068.png":{x:128,y:64,width:16,height:16},"tile_0069.png":{x:128,y:80,width:16,height:16},"tile_0070.png":{x:128,y:96,width:16,height:16},"tile_0071.png":{x:128,y:112,width:16,height:16},"tile_0072.png":{x:0,y:128,width:16,height:16},"tile_0073.png":{x:16,y:128,width:16,height:16},"tile_0074.png":{x:32,y:128,width:16,height:16},"tile_0075.png":{x:48,y:128,width:16,height:16},"tile_0076.png":{x:64,y:128,width:16,height:16},"tile_0077.png":{x:80,y:128,width:16,height:16},"tile_0078.png":{x:96,y:128,width:16,height:16},"tile_0079.png":{x:112,y:128,width:16,height:16},"tile_0080.png":{x:128,y:128,width:16,height:16},"tile_0081.png":{x:144,y:0,width:16,height:16},"tile_0082.png":{x:144,y:16,width:16,height:16},"tile_0083.png":{x:144,y:32,width:16,height:16},"tile_0084.png":{x:144,y:48,width:16,height:16},"tile_0085.png":{x:144,y:64,width:16,height:16},"tile_0086.png":{x:144,y:80,width:16,height:16},"tile_0087.png":{x:144,y:96,width:16,height:16},"tile_0088.png":{x:144,y:112,width:16,height:16},"tile_0089.png":{x:144,y:128,width:16,height:16},"tile_0090.png":{x:0,y:144,width:16,height:16},"tile_0091.png":{x:16,y:144,width:16,height:16},"tile_0092.png":{x:32,y:144,width:16,height:16},"tile_0093.png":{x:48,y:144,width:16,height:16},"tile_0094.png":{x:64,y:144,width:16,height:16},"tile_0095.png":{x:80,y:144,width:16,height:16},"tile_0096.png":{x:96,y:144,width:16,height:16},"tile_0097.png":{x:112,y:144,width:16,height:16},"tile_0098.png":{x:128,y:144,width:16,height:16},"tile_0099.png":{x:144,y:144,width:16,height:16},"tile_0100.png":{x:160,y:0,width:16,height:16},"tile_0101.png":{x:160,y:16,width:16,height:16},"tile_0102.png":{x:160,y:32,width:16,height:16},"tile_0103.png":{x:160,y:48,width:16,height:16},"tile_0104.png":{x:160,y:64,width:16,height:16},"tile_0105.png":{x:160,y:80,width:16,height:16},"tile_0106.png":{x:160,y:96,width:16,height:16},"tile_0107.png":{x:160,y:112,width:16,height:16},"tile_0108.png":{x:160,y:128,width:16,height:16},"tile_0109.png":{x:160,y:144,width:16,height:16},"tile_0110.png":{x:0,y:160,width:16,height:16},"tile_0111.png":{x:16,y:160,width:16,height:16},"tile_0112.png":{x:32,y:160,width:16,height:16},"tile_0113.png":{x:48,y:160,width:16,height:16},"tile_0114.png":{x:64,y:160,width:16,height:16},"tile_0115.png":{x:80,y:160,width:16,height:16},"tile_0116.png":{x:96,y:160,width:16,height:16},"tile_0117.png":{x:112,y:160,width:16,height:16},"tile_0118.png":{x:128,y:160,width:16,height:16},"tile_0119.png":{x:144,y:160,width:16,height:16},"tile_0120.png":{x:160,y:160,width:16,height:16},"tile_0121.png":{x:176,y:0,width:16,height:16},"tile_0122.png":{x:176,y:16,width:16,height:16},"tile_0123.png":{x:176,y:32,width:16,height:16},"tile_0124.png":{x:176,y:48,width:16,height:16},"tile_0125.png":{x:176,y:64,width:16,height:16},"tile_0126.png":{x:176,y:80,width:16,height:16},"tile_0127.png":{x:176,y:96,width:16,height:16},"tile_0128.png":{x:176,y:112,width:16,height:16},"tile_0129.png":{x:176,y:128,width:16,height:16},"tile_0130.png":{x:176,y:144,width:16,height:16},"tile_0131.png":{x:176,y:160,width:16,height:16}},at=[0,0],wt=262144,pt=Math.PI/180,_t=[0,0],ft=524292,xt=1,yt=new class extends class extends class{constructor(){this.Zt=0,this.ti=0,this.Et=window.innerWidth,this.Xt=window.innerHeight,this.ii=!0,this.C={MouseX:0,MouseY:0},this.ei={MouseX:0,MouseY:0},this.hi={Mouse:0,Mouse0:0,Mouse1:0,Mouse2:0,Touch0:0,Touch1:0},this.ni={},this.Nt=document.querySelector("main"),document.addEventListener("visibilitychange",(()=>document.hidden?this.oi():this.li())),this.Nt.addEventListener("contextmenu",(t=>t.preventDefault())),this.Nt.addEventListener("mousedown",(t=>{this.C["Mouse"+t.button]=1,this.ei["Mouse"+t.button]=1})),this.Nt.addEventListener("mouseup",(t=>{this.C["Mouse"+t.button]=0,this.ei["Mouse"+t.button]=-1})),this.Nt.addEventListener("mousemove",(t=>{this.C.MouseX=t.clientX,this.C.MouseY=t.clientY,this.ei.MouseX=t.movementX,this.ei.MouseY=t.movementY})),this.Nt.addEventListener("wheel",(t=>{t.preventDefault(),this.ei.WheelY=t.deltaY})),this.Nt.addEventListener("touchstart",(t=>{t.target===this.Nt&&t.preventDefault(),1===t.touches.length&&(this.ni={});for(let i=0;i<t.touches.length;i++)this.ni[t.touches[i].identifier]=i;for(let i=0;i<t.changedTouches.length;i++){let e=t.changedTouches[i],h=this.ni[e.identifier];this.C["Touch"+h]=1,this.C[`Touch${h}X`]=e.clientX,this.C[`Touch${h}Y`]=e.clientY,this.ei["Touch"+h]=1,this.ei[`Touch${h}X`]=0,this.ei[`Touch${h}Y`]=0}})),this.Nt.addEventListener("touchmove",(t=>{t.target===this.Nt&&t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){let e=t.changedTouches[i],h=this.ni[e.identifier];this.ei[`Touch${h}X`]=e.clientX-this.C[`Touch${h}X`],this.ei[`Touch${h}Y`]=e.clientY-this.C[`Touch${h}Y`],this.C[`Touch${h}X`]=e.clientX,this.C[`Touch${h}Y`]=e.clientY}})),this.Nt.addEventListener("touchend",(t=>{t.target===this.Nt&&t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){let e=this.ni[t.changedTouches[i].identifier];this.C["Touch"+e]=0,this.ei["Touch"+e]=-1}})),this.Nt.addEventListener("touchcancel",(t=>{for(let i=0;i<t.changedTouches.length;i++){let e=this.ni[t.changedTouches[i].identifier];this.C["Touch"+e]=0,this.ei["Touch"+e]=-1}})),window.addEventListener("keydown",(t=>{t.repeat||(this.C[t.code]=1,this.ei[t.code]=1)})),window.addEventListener("keyup",(t=>{this.C[t.code]=0,this.ei[t.code]=-1}))}li(){let t=0,i=performance.now(),e=h=>{let n=(h-i)/1e3;for(i=h,this.Zt=requestAnimationFrame(e),this.si(n),t+=n;t>=et;)t-=et,this.ri(et);this.gi(n),this.di(n)};this.oi(),e(i)}oi(){cancelAnimationFrame(this.Zt),this.Zt=0}si(t){this.ti=performance.now();let i=Math.abs(this.ei.MouseX)+Math.abs(this.ei.MouseY);this.hi.Mouse+=i,1===this.C.Mouse0&&(this.hi.Mouse0+=i),1===this.C.Mouse1&&(this.hi.Mouse1+=i),1===this.C.Mouse2&&(this.hi.Mouse2+=i),1===this.C.Touch0&&(this.hi.Touch0+=Math.abs(this.ei.Touch0X)+Math.abs(this.ei.Touch0Y)),1===this.C.Touch1&&(this.hi.Touch1+=Math.abs(this.ei.Touch1X)+Math.abs(this.ei.Touch1Y))}ri(t){}gi(t){}di(t){this.ii=!1,-1===this.ei.Mouse0&&(this.hi.Mouse0=0),-1===this.ei.Mouse1&&(this.hi.Mouse1=0),-1===this.ei.Mouse2&&(this.hi.Mouse2=0),-1===this.ei.Touch0&&(this.hi.Touch0=0),-1===this.ei.Touch1&&(this.hi.Touch1=0);for(let t in this.ei)this.ei[t]=0;let i=performance.now()-this.ti;Z&&(Z.textContent=i.toFixed(1)),tt&&(tt.textContent=(1e3*t).toFixed(1)),it&&(it.textContent=(1/t).toFixed())}}{constructor(){super(),this.ci=document.querySelector("#background"),this.ui=this.ci.getContext("2d"),this.ai=document.querySelector("#foreground"),this.wi=this.ai.getContext("2d"),this.pi=document.querySelector("#scene"),this.vt=this.pi.getContext("webgl2"),this.Audio=new AudioContext,this._i=[],this.fi={},this.vt.enable(2929),this.vt.enable(2884),this.vt.blendFunc(770,771)}}{constructor(){super(),this.i=new nt(65536),this.xt=function(t,e,h){let n=function(t,e,h){let n=t.createProgram();return t.attachShader(n,i(t,35633,e)),t.attachShader(n,i(t,35632,"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D sheet_texture;\n\nin vec2 vert_texcoord;\nin vec4 vert_color;\n\nout vec4 frag_color;\n\nvoid main() {\nfrag_color = vert_color * texture(sheet_texture, vert_texcoord);\nif (frag_color.a == 0.0) {\ndiscard;\n}\n}\n")),t.linkProgram(n),n}(t,"#version 300 es\n\nuniform mat3x2 pv;\nuniform vec2 sheet_size;\n\n\nlayout(location=0) in vec2 attr_position;\nlayout(location=1) in vec2 attr_texcoord;\n\n\nlayout(location=2) in vec4 attr_rotation; \nlayout(location=3) in vec4 attr_translation; \nlayout(location=4) in vec4 attr_color;\nlayout(location=5) in vec4 attr_sprite;\n\nout vec2 vert_texcoord;\nout vec4 vert_color;\nout vec4 vert_sprite;\n\nvoid main() {\nint signature = int(attr_translation.w);\nif ((signature & 4096) == 4096) {\nmat3x2 world;\nif ((signature & 32768) == 32768) {\nworld = mat3x2(\nattr_rotation.xy,\nattr_rotation.zw,\nattr_translation.xy\n);\n} else {\nvec2 scale = attr_rotation.xy;\nfloat rotation = attr_rotation.z;\nworld = mat3x2(\ncos(rotation) * scale.x, sin(rotation) * scale.x,\n-sin(rotation) * scale.y, cos(rotation) * scale.y,\nattr_translation.xy\n);\n}\n\nvec3 world_position = mat3(world) * vec3(attr_position, 1);\nvec3 clip_position = mat3(pv) * world_position;\ngl_Position = vec4(clip_position.xy, -attr_translation.z, 1);\n\n\nvert_texcoord = (attr_sprite.xy + attr_sprite.zw * attr_texcoord) / sheet_size;\nvert_color = attr_color;\n} else {\n\ngl_Position.z = 2.0;\n}\n}");return{bt:5,Mt:n,Ft:{Tt:t.getUniformLocation(n,"pv"),i:t.getUniformLocation(n,"world"),kt:t.getUniformLocation(n,"sheet_texture"),St:t.getUniformLocation(n,"sheet_size")}}}(this.vt),this.yt=function(t,i){let e=t.createTexture();return t.bindTexture(J,e),t.texImage2D(J,0,6408,6408,5121,i),t.texParameteri(J,10241,9728),t.texParameteri(J,10240,9728),t.texParameteri(J,10242,10497),t.texParameteri(J,10243,10497),{At:e,j:i.width,K:i.height}}(this.vt,document.querySelector("img")),this.nt=new Float32Array(this.i.jt*ht),this.$t=this.vt.createBuffer(),this.ft=32,this._t=32,this.vt.clearColor(0,0,0,0),this.vt.disable(2929),this.vt.enable(3042),function(t,i){let e=Float32Array.from([-.5,-.5,0,1,.5,-.5,1,1,-.5,.5,0,0,.5,.5,1,0]);t.bindBuffer(B,t.createBuffer()),t.bufferData(B,e,35044),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,Q,!1,16,0),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,2,Q,!1,16,8),t.bindBuffer(B,i),t.enableVertexAttribArray(2),t.vertexAttribDivisor(2,1),t.vertexAttribPointer(2,4,Q,!1,64,0),t.enableVertexAttribArray(3),t.vertexAttribDivisor(3,1),t.vertexAttribPointer(3,4,Q,!1,64,16),t.enableVertexAttribArray(4),t.vertexAttribDivisor(4,1),t.vertexAttribPointer(4,4,Q,!1,64,32),t.enableVertexAttribArray(5),t.vertexAttribDivisor(5,1),t.vertexAttribPointer(5,4,Q,!1,64,48)}(this.vt,this.$t)}ri(t){!function(t,i){for(let e=0;e<t.i.k.length;e++)8704==(8704&t.i.k[e])&&D(t,e,i)}(this,t),function(t,i){for(let i=0;i<t.i.k.length;i++)8704==(8704&t.i.k[i])&&C(t,i)}(this),q(this),function(t,i){let e=[],h=[];for(let i=0;i<t.i.k.length;i++)if(32772==(32772&t.i.k[i])){let n=t.i.ht[i],o=t.i.W[i];o._=[],o.H?(o.H=!1,r(n.i,o)):o.U?(r(n.i,o),h.push(o)):e.push(o)}for(let t=0;t<h.length;t++)d(h[t],e,e.length),d(h[t],h,t)}(this),function(t,i){for(let i=0;i<t.i.k.length;i++)(t.i.k[i]&gt)===gt&&R(t,i);for(let i=0;i<t.i.k.length;i++)if((t.i.k[i]&gt)===gt){let e=t.i.$[i];1===e.q&&a(e.tt,e.it)}}(this),function(t,i){for(let i=0;i<t.i.k.length;i++)(t.i.k[i]&ft)===ft&&K(t,i)}(this)}gi(i){!function(t,i){let e=[];for(let h=0;h<t.i.k.length;h++)if((t.i.k[h]&ct)===ct){if(P(t.i,h))continue;let n=t.i.Jt[h];switch(n.q){case 0:n.xi(h)&&e.push(h);break;case 1:n.gt-=i,n.gt<0&&e.push(h);break;case 2:e.push(h)}}for(let i of e){let e=t.i.Jt[i];switch(e.q){case 2:e.yi(i);case 0:case 1:t.i.ut(i)}delete t.i.Jt[i]}}(this,i),function(t,i){if(t.Et==window.innerWidth&&t.Xt==window.innerHeight||(t.ii=!0),t.ii){t.Et=t.ci.width=t.pi.width=t.ai.width=window.innerWidth,t.Xt=t.ci.height=t.pi.height=t.ai.height=window.innerHeight;for(let i=0;i<t.i.k.length;i++)2==(2&t.i.k[i])&&W(t,i)}}(this),function(t,i){t._i=[];for(let i=0;i<t.i.k.length;i++)if(32770==(32770&t.i.k[i])){let o=t.i.Pt[i],l=t.i.ht[i];n(o.Tt,o.Yt.Yt,l.ot),e(o.i,(h=l.i)[0],h[1],h[2],h[3],h[4],h[5]),t._i.push(i)}var h}(this),function(t,i){for(let i=0;i<t.i.k.length;i++)9232==(9232&t.i.k[i])&&u(t,i)}(this),function(i,e){let h=i._i[0];var n,o,l;void 0!==h&&(ot+=e)>.1&&function(t,i){return 1===t.C.Touch0||-1===t.ei.Touch0?(i[0]=t.C.Touch0X,i[1]=t.C.Touch0Y,!0):t.hi.Mouse>0&&(i[0]=t.C.MouseX,i[1]=t.C.MouseY,!0)}(i,lt)&&function(t,i,e=i){return t.C["Mouse"+i]>0||t.C["Touch"+e]>0}(i,0)&&((n=lt)[0]=(l=lt)[0]/(o=i.i.Pt[h]).Et*2-1,n[1]=-l[1]/o.Xt*2+1,f(n,n,o.Yt.Wt),f(n,n,o.i),t(i,[...k(),y(lt)]),ot=0)}(this,i),function(t,i){for(let i=0;i<t.i.k.length;i++)1032==(1032&t.i.k[i])&&c(t,i)}(this),function(t,i){for(let e=0;e<t.i.k.length;e++)1600==(1600&t.i.k[e])&&z(t,e,i)}(this,i),function(t,i){for(let e=0;e<t.i.k.length;e++)256==(256&t.i.k[e])&&b(t,e,i)}(this,i),function(t,i){for(let i=0;i<t.i.k.length;i++)16896==(16896&t.i.k[i])&&H(t,i)}(this),function(t,i){for(let e=0;e<t.i.k.length;e++)(t.i.k[e]&wt)==wt&&V(t,e,i)}(this,i),function(t,i){for(let e=0;e<t.i.k.length;e++)98304==(98304&t.i.k[e])&&U(t,e,i)}(this,i),q(this),function(t,i){let e=t._i[0];if(void 0===e)return;let h=t.i.Pt[e],n=t.ui;n.resetTransform(),n.fillStyle="#EEE",n.fillRect(0,0,t.Et,t.Xt),n.transform(h.Tt[0]/2*t.Et,-h.Tt[1]/2*t.Et,-h.Tt[2]/2*t.Xt,h.Tt[3]/2*t.Xt,(h.Tt[4]+1)/2*t.Et,(h.Tt[5]+1)/2*t.Xt);for(let i=0;i<t.i.k.length;i++)if(32896==(32896&t.i.k[i])){let e=t.i.ht[i];n.save(),n.transform(e.i[0],-e.i[1],-e.i[2],e.i[3],e.i[4],-e.i[5]);let h=t.i.V[i];switch(h.q){case 1:n.fillStyle=h.I,n.fillRect(-h.j/2,-h.K/2,h.j,h.K);break;case 2:n.fillStyle=h.I,n.beginPath(),n.arc(0,0,h.L,h.G,h.N),n.fill()}n.restore()}}(this),function(t,i){for(let e=0;e<t.i.k.length;e++)4097==(4097&t.i.k[e])&&Y(t,e,i)}(this,i),function(t,i){for(let i=0;i<t.i.k.length;i++){let e=36864&t.i.k[i],h=i*ht+7;t.nt[h]!==e&&(t.nt[h]=e)}for(let i of t._i){let e=t.i.Pt[i];t.vt.bindFramebuffer(36160,null),t.vt.viewport(0,0,t.Et,t.Xt),t.vt.clear(16640),E(t,e);break}}(this),G(this)}};!function(i){var e;i.i=new nt(65536),i.ii=!0,t(i,[A(),x([0,0]),(e=[i.ft/2+1,i._t/2+1],(t,i)=>{t.i.k[i]|=2,t.i.Pt[i]={Yt:{L:e,Yt:[1/e[0],0,0,1/e[1],0,0],Wt:[e[0],0,0,e[1],0,0]},Tt:[1,0,0,1,0,0],i:[1,0,0,1,0,0],Et:0,Xt:0}})]),t(i,[A(),x(),m("#FFD6D5",i.ft,i._t)]),t(i,[A(),x([-5,3],0),M("#D4FCA9",7)]),t(i,[A(),x([0,0],-30,[4,1]),T(0,5),(t,i)=>{t.i.k[i]|=8,t.i.T[i]={A:null,S:1}},S([A(),x([0,0],30),m("#FFAA79",5,5)])]);for(let e=0;e<10;e++){let e=N(-i.ft/2,i.ft/2),h=N(-i._t/2,i._t/2);t(i,[A(),x([e,h],0,[4,1]),v(!1,1,0,[4,1]),F(0),m("green")])}t(i,[...k(),(t,i)=>{let e=t.i.P[i];e.X[0]=0,e.X[1]=5}])}(yt),yt.li(),window.$=function(t,i,e){}.bind(null,yt),window.game=yt})();
